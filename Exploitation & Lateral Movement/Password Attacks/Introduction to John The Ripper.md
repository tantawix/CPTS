- اداة John The Ripper هيا اداة بتعمل password cracking سواء كان brute-force او dictionary
- الاداه دي open-source وكانت معموله فالاول هدفها تفحص قوة باسوردات انظمة Unix وطبعا الباسوردات كانت بتتسجل زمان في `etc/passwd/` فا الاداة كانت بتأكسس الفايل وبتحاول تكراك الباسورد
- خلي بالك اداة john the ripper فيها مجموعة ادوات صغيره وظيفتها تحويل اي ملف مقفول بباسورد لحاجة التول تفهمها
-يعني مثلا لو لقيت ملف SSH Key محمي بباسورد بتستخدم تول `ssh2john`
-لو عندك ملف ZIP محمي بباسورد بتستخدم `zip2john` وهكذا بقي

---
## Cracking modes
#### Single crack mode
- الsingle crack mode ده rule-based cracking technique لو انت بتتارجتlinux credentials
- التكنيك ده بيعمل باسوردات محتملة بناءا علي الusername بتاع الvictim او الdir name اللي بيجبها من ملف ال`etc/passwd`
- الstrings دي اللي هيا الusername او الdir name او الfull name او الroom num بتوع الvictim بتخضع لبعض القواعد بتخلي عملية الcracking اقوي يعني مثلا (انت مدخل للتول ان الfull name بتاع الضحيه Bob Smith ف الاداة ممكن تستخدم مثلا كلمة سر زي Smith1 مثلا)
```
john --single hashes.txt
```

- يعني مثلا تخيل معايا
```
r0lf:$6$ues25dIanlctrWxg$nZHVz2z4kCy1760Ee28M1xtHdGoy0C2cYzZ8l2sVa1kIa8K9gAcdBP.GI6ng/qA4oaMrgElZ1Cb9OeXO4Fvy3/:0:0:Rolf Sebastian:/home/r0lf:/bin/bash
```
السطر ده موجود ف ملف الpasswd
- من خلال السطر ده ممكن نعرف ان اليوزرنيم اسمه `r0lf` واسمه الحقيقي `Rolf Sebastian` والhome dir هو `/home/r0lf`
- هنا بقي الsingle crack mode هيستخدم البيانات دي وهيولد باسوردات محتمله بناءا علي المعلومات دي وهيقعد يجربها
```shell-session
0xTroj6n@htb[/htb]$ john --single passwd

Using default input encoding: UTF-8
Loaded 1 password hash (sha512crypt, crypt(3) $6$ [SHA512 256/256 AVX2 4x])
Cost 1 (iteration count) is 5000 for all loaded hashes
Will run 4 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
[...SNIP...]        (r0lf)     
1g 0:00:00:00 DONE 1/3 (2025-04-10 07:47) 12.50g/s 5400p/s 5400c/s 5400C/s NAITSABESFL0R..rSebastiannaitsabeSr
Use the "--show" option to display all of the cracked passwords reliably
Session completed.
```
---
#### Wordlist mode
- الwordlist mode وده تاني مود معانا وده بيستخدم الdictionary attack يعني ببساطه الاداة بتحاول تجرب الباسوردات اللي موجوده فالwordlist
```shell-session
0xTroj6n@htb[/htb]$ john --wordlist=<wordlist_file> <hash_file>
```
- خلي بالك لازم الwordlist اللي هتديهاله دي تكون plain text وهو بيحولها ل hash وبيقارن الهاش اللي طلع بالهاش اللي انت عايز تكراكه
- لازم الwordlist تكون كل سطر كلمة سر واحده مينفعش تحط كلمتين بينهم مسافه
- لو عايز تستخدم اكتر من wordlist هتكتب
```
--wordlist=pass1.txt,pass2.txt
```
- دلوقتي تخيل معايا لو الwordlist فيها كلمة `soccer` لو الباسورد الحقيقي بتاع الضحيه `soccer123` طبعا هيعديها لأنها مش مطابقه
- بس خلي بالك في عندنا argument اسمه `--rules` ودي بتكون قواعد جاهزة جوه التول بتقعد تشقلب في الكلمات وتلعب فيها زي انها تخلي الحروف capital او تزود ارقام في الاخر او تحط علامات تعجب ولو انت بقي شخص جامد ممكن تكتب انت قواعد بنفسك
-الكلمة الأصلية: `pawn`
-بعد تطبيق القواعد: `Pawn`, `pawn123`, `P@wn`, `nwaP`.
```
john --wordlist=/usr/share/wordlists/rockyou.txt --rules hash.txt
```
----
#### Incremental mode
- الincremental mode ده قوي وده عباره عن مود ذكي جدا بيستخدم Markov Chains في عملية التخمين
- فكرة الMarkov Chains ده تكنيك بيقولك ايه الحاجه الجايه بناءا علي انت واقف فين يعني مثلا - لو النهاردة "شمس"، ففيه احتمال 70% إن بكرة يفضل "شمس" و 30% إنها "تمطر"
- في "ماركوف"، السيستم مش مهتم لو كانت بتمطر بقالها أسبوع، هو بيبص على "النهاردة" بس عشان يتوقع "بكرة"
- لو السيستم خمن إن أول حرف هو `q`.. الـ Markov Chain بتقول له: "بناءً على اللغة الإنجليزية، فيه احتمال 95% إن الحرف اللي جاي يكون `u`"
- كدة الأداة مش بتضيع وقتها في تجربة `qz` أو `qx` لأن احتمالية وجودهم ورا بعض ضعيفة جداً
**الفرق بينها وبين بقيت المودات**
- في الاوضاع اللي فاتت كنا بندي للأداة ملف زي `rockyou.txt` تقرأ منه لكن الIncremental Mode هو اللي بيخترع الباسوردات ومش هيسيب ولا احتمال غير ان هدفه انه يكسر الباسوردات اللي مستحيل تلاقيها ف اي wordlist زي `xP9!q2` مثلا
- ميزة تانيه فيه انه متدرب علي بيانات حقيقه يعني مثلا هو عارف إن حرف e بيجي كتير فالباسوردات وبعد مثلا بيجي f وهكذا
- بس عيبه اكيد انه Time-Consuming يعني بياخد وقت طويل
```shell-session
0xTroj6n@htb[/htb]$ john --incremental <hash_file>
```
خلي بالك ان التول بتستخدم في مود الincremental فايل config file اسمه `john.conf` بيعرف فيه الchar sets and pass length وطبعا ممكن تعدل عليها براحتك

```shell-session
0xTroj6n@htb[/htb]$ grep '# Incremental modes' -A 100 /etc/john/john.conf

# Incremental modes

# This is for one-off uses (make your own custom.chr).
# A charset can now also be named directly from command-line, so no config
# entry needed: --incremental=whatever.chr
[Incremental:Custom]
File = $JOHN/custom.chr
MinLen = 0

# The theoretical CharCount is 211, we've got 196.
[Incremental:UTF8]
File = $JOHN/utf8.chr
MinLen = 0
CharCount = 196

# This is CP1252, a super-set of ISO-8859-1.
# The theoretical CharCount is 219, we've got 203.
[Incremental:Latin1]
File = $JOHN/latin1.chr
MinLen = 0
CharCount = 203

[Incremental:ASCII]
File = $JOHN/ascii.chr
MinLen = 0
MaxLen = 13
CharCount = 95

...SNIP...
```
---
## Identifying hash formats
- خلي بالك الpassword hashes بتكون unknown format يعني مفيهاش حاجه مميزه تعرفك الformat حتي التول معندهاش القدره انها تعرف نوع الhash
ف لو معانا مثلا hash زي ده :
```
193069ceb0461e1d40d216e32c79c704
```
عاوزين نعرف نوعه؟ يبقي هنستخدم اداة اسمها `hashid`

```shell-session
0xTroj6n@htb[/htb]$ hashid -j 193069ceb0461e1d40d216e32c79c704

Analyzing '193069ceb0461e1d40d216e32c79c704'
[+] MD2 [JtR Format: md2]
[+] MD5 [JtR Format: raw-md5]
[+] MD4 [JtR Format: raw-md4]
[+] Double MD5 
[+] LM [JtR Format: lm]
[+] RIPEMD-128 [JtR Format: ripemd-128]
[+] Haval-128 [JtR Format: haval-128-4]
[+] Tiger-128 
[+] Skein-256(128) 
[+] Skein-512(128) 
[+] Lotus Notes/Domino 5 [JtR Format: lotus5]
[+] Skype 
[+] Snefru-128 [JtR Format: snefru-128]
[+] NTLM [JtR Format: nt]
[+] Domain Cached Credentials [JtR Format: mscach]
[+] Domain Cached Credentials 2 [JtR Format: mscach2]
[+] DNSSEC(NSEC3) 
[+] RAdmin v2.x [JtR Format: radmin]
```
- لو شوفت الشكل ده كده مش هتعرف الهاش انهي نوع عشان المفروض مطلعلك انواع كتير زي منتا شايف ودي انواع محتمله يعني مثلا نوع الهاش هنا هو `RIPEMD-128` بس خلي بالك الJtr ليها لعة خاصه في تسمية الformats دي ودي اشهر الفورماتات وطريقة كتابتها

| **Hash format**      | **Example command**                               | **Description**                                                      |
| -------------------- | ------------------------------------------------- | -------------------------------------------------------------------- |
| afs                  | `john --format=afs [...] <hash_file>`             | AFS (Andrew File System) password hashes                             |
| bfegg                | `john --format=bfegg [...] <hash_file>`           | bfegg hashes used in Eggdrop IRC bots                                |
| bf                   | `john --format=bf [...] <hash_file>`              | Blowfish-based crypt(3) hashes                                       |
| bsdi                 | `john --format=bsdi [...] <hash_file>`            | BSDi crypt(3) hashes                                                 |
| crypt(3)             | `john --format=crypt [...] <hash_file>`           | Traditional Unix crypt(3) hashes                                     |
| des                  | `john --format=des [...] <hash_file>`             | Traditional DES-based crypt(3) hashes                                |
| dmd5                 | `john --format=dmd5 [...] <hash_file>`            | DMD5 (Dragonfly BSD MD5) password hashes                             |
| dominosec            | `john --format=dominosec [...] <hash_file>`       | IBM Lotus Domino 6/7 password hashes                                 |
| EPiServer SID hashes | `john --format=episerver [...] <hash_file>`       | EPiServer SID (Security Identifier) password hashes                  |
| hdaa                 | `john --format=hdaa [...] <hash_file>`            | hdaa password hashes used in Openwall GNU/Linux                      |
| hmac-md5             | `john --format=hmac-md5 [...] <hash_file>`        | hmac-md5 password hashes                                             |
| hmailserver          | `john --format=hmailserver [...] <hash_file>`     | hmailserver password hashes                                          |
| ipb2                 | `john --format=ipb2 [...] <hash_file>`            | Invision Power Board 2 password hashes                               |
| krb4                 | `john --format=krb4 [...] <hash_file>`            | Kerberos 4 password hashes                                           |
| krb5                 | `john --format=krb5 [...] <hash_file>`            | Kerberos 5 password hashes                                           |
| LM                   | `john --format=LM [...] <hash_file>`              | LM (Lan Manager) password hashes                                     |
| lotus5               | `john --format=lotus5 [...] <hash_file>`          | Lotus Notes/Domino 5 password hashes                                 |
| mscash               | `john --format=mscash [...] <hash_file>`          | MS Cache password hashes                                             |
| mscash2              | `john --format=mscash2 [...] <hash_file>`         | MS Cache v2 password hashes                                          |
| mschapv2             | `john --format=mschapv2 [...] <hash_file>`        | MS CHAP v2 password hashes                                           |
| mskrb5               | `john --format=mskrb5 [...] <hash_file>`          | MS Kerberos 5 password hashes                                        |
| mssql05              | `john --format=mssql05 [...] <hash_file>`         | MS SQL 2005 password hashes                                          |
| mssql                | `john --format=mssql [...] <hash_file>`           | MS SQL password hashes                                               |
| mysql-fast           | `john --format=mysql-fast [...] <hash_file>`      | MySQL fast password hashes                                           |
| mysql                | `john --format=mysql [...] <hash_file>`           | MySQL password hashes                                                |
| mysql-sha1           | `john --format=mysql-sha1 [...] <hash_file>`      | MySQL SHA1 password hashes                                           |
| NETLM                | `john --format=netlm [...] <hash_file>`           | NETLM (NT LAN Manager) password hashes                               |
| NETLMv2              | `john --format=netlmv2 [...] <hash_file>`         | NETLMv2 (NT LAN Manager version 2) password hashes                   |
| NETNTLM              | `john --format=netntlm [...] <hash_file>`         | NETNTLM (NT LAN Manager) password hashes                             |
| NETNTLMv2            | `john --format=netntlmv2 [...] <hash_file>`       | NETNTLMv2 (NT LAN Manager version 2) password hashes                 |
| NEThalfLM            | `john --format=nethalflm [...] <hash_file>`       | NEThalfLM (NT LAN Manager) password hashes                           |
| md5ns                | `john --format=md5ns [...] <hash_file>`           | md5ns (MD5 namespace) password hashes                                |
| nsldap               | `john --format=nsldap [...] <hash_file>`          | nsldap (OpenLDAP SHA) password hashes                                |
| ssha                 | `john --format=ssha [...] <hash_file>`            | ssha (Salted SHA) password hashes                                    |
| NT                   | `john --format=nt [...] <hash_file>`              | NT (Windows NT) password hashes                                      |
| openssha             | `john --format=openssha [...] <hash_file>`        | OPENSSH private key password hashes                                  |
| oracle11             | `john --format=oracle11 [...] <hash_file>`        | Oracle 11 password hashes                                            |
| oracle               | `john --format=oracle [...] <hash_file>`          | Oracle password hashes                                               |
| pdf                  | `john --format=pdf [...] <hash_file>`             | PDF (Portable Document Format) password hashes                       |
| phpass-md5           | `john --format=phpass-md5 [...] <hash_file>`      | PHPass-MD5 (Portable PHP password hashing framework) password hashes |
| phps                 | `john --format=phps [...] <hash_file>`            | PHPS password hashes                                                 |
| pix-md5              | `john --format=pix-md5 [...] <hash_file>`         | Cisco PIX MD5 password hashes                                        |
| po                   | `john --format=po [...] <hash_file>`              | Po (Sybase SQL Anywhere) password hashes                             |
| rar                  | `john --format=rar [...] <hash_file>`             | RAR (WinRAR) password hashes                                         |
| raw-md4              | `john --format=raw-md4 [...] <hash_file>`         | Raw MD4 password hashes                                              |
| raw-md5              | `john --format=raw-md5 [...] <hash_file>`         | Raw MD5 password hashes                                              |
| raw-md5-unicode      | `john --format=raw-md5-unicode [...] <hash_file>` | Raw MD5 Unicode password hashes                                      |
| raw-sha1             | `john --format=raw-sha1 [...] <hash_file>`        | Raw SHA1 password hashes                                             |
| raw-sha224           | `john --format=raw-sha224 [...] <hash_file>`      | Raw SHA224 password hashes                                           |
| raw-sha256           | `john --format=raw-sha256 [...] <hash_file>`      | Raw SHA256 password hashes                                           |
| raw-sha384           | `john --format=raw-sha384 [...] <hash_file>`      | Raw SHA384 password hashes                                           |
| raw-sha512           | `john --format=raw-sha512 [...] <hash_file>`      | Raw SHA512 password hashes                                           |
| salted-sha           | `john --format=salted-sha [...] <hash_file>`      | Salted SHA password hashes                                           |
| sapb                 | `john --format=sapb [...] <hash_file>`            | SAP CODVN B (BCODE) password hashes                                  |
| sapg                 | `john --format=sapg [...] <hash_file>`            | SAP CODVN G (PASSCODE) password hashes                               |
| sha1-gen             | `john --format=sha1-gen [...] <hash_file>`        | Generic SHA1 password hashes                                         |
| skey                 | `john --format=skey [...] <hash_file>`            | S/Key (One-time password) hashes                                     |
| ssh                  | `john --format=ssh [...] <hash_file>`             | SSH (Secure Shell) password hashes                                   |
| sybasease            | `john --format=sybasease [...] <hash_file>`       | Sybase ASE password hashes                                           |
| xsha                 | `john --format=xsha [...] <hash_file>`            | xsha (Extended SHA) password hashes                                  |
| zip                  | `john --format=zip [...] <hash_file>`             | ZIP (WinZip) password hashes                                         |

---
## Cracking files
- خلي بالك لو عند ملف متشفر تقدر تفكه بjohn محنا قولنا فوق انك تقدر تستخدم `john2` اصحي معايا كده
```shell-session
0xTroj6n@htb[/htb]$ <tool> <file_to_crack> > file.hash
```

|**Tool**|**Description**|
|---|---|
|`pdf2john`|Converts PDF documents for John|
|`ssh2john`|Converts SSH private keys for John|
|`mscash2john`|Converts MS Cash hashes for John|
|`keychain2john`|Converts OS X keychain files for John|
|`rar2john`|Converts RAR archives for John|
|`pfx2john`|Converts PKCS#12 files for John|
|`truecrypt_volume2john`|Converts TrueCrypt volumes for John|
|`keepass2john`|Converts KeePass databases for John|
|`vncpcap2john`|Converts VNC PCAP files for John|
|`putty2john`|Converts PuTTY private keys for John|
|`zip2john`|Converts ZIP archives for John|
|`hccap2john`|Converts WPA/WPA2 handshake captures for John|
|`office2john`|Converts MS Office documents for John|
|`wpa2john`|Converts WPA/WPA2 handshakes for John|
|...SNIP...|...SNIP...|
```shell-session
0xTroj6n@htb[/htb]$ locate *2john*

/usr/bin/bitlocker2john
/usr/bin/dmg2john
/usr/bin/gpg2john
/usr/bin/hccap2john
/usr/bin/keepass2john
/usr/bin/putty2john
/usr/bin/racf2john
/usr/bin/rar2john
/usr/bin/uaf2john
/usr/bin/vncpcap2john
/usr/bin/wlanhcx2john
/usr/bin/wpapcap2john
/usr/bin/zip2john
/usr/share/john/1password2john.py
/usr/share/john/7z2john.pl
/usr/share/john/DPAPImk2john.py
/usr/share/john/adxcsouf2john.py
/usr/share/john/aem2john.py
/usr/share/john/aix2john.pl
/usr/share/john/aix2john.py
/usr/share/john/andotp2john.py
/usr/share/john/androidbackup2john.py
...SNIP...
```
---
