- بعيدا عن الملفات المستقله بذاتها دايما بنلاقي ملفات متأرشفه او ZIP اللي بتكون محميه بكلمة سر
- في انواع كتير من الملفات المأرشفه اللي هتقابلها كتير زي tar,gz,rar,zaip,vmdb/vmx,cpt,truecrypt,bitlocker,kdbx,deb,7z,gzip
```shell-session
0xTroj6n@htb[/htb]$ curl -s https://fileinfo.com/filetypes/compressed | html2text | awk '{print tolower($1)}' | grep "\." | tee -a compressed_ext.txt

.mint
.zhelp
.b6z
.fzpz
.zst
.apz
.ufs.uzip
.vrpackage
.sfg
.gzip
.xapk
.rar
.pkg.tar.xz
<SNIP>
```
- ملفات زي الZIP والRAR عندها ميزة ضغط الملفات طبعا وف نفس الوقت فيها ميزة انك تقفلها بباسورد إنما ملفات الTAR بتضغط بس وميعرفش يعمل باسورد
- ف عشان نعمل باسورد لملفات الTAR بنستخدم ادوات خارجيه زي `openssl or gpg`
---
## Cracking ZIP files
- الZIP format مستخدم في الwindows بشكل كبير وعشان نستخرج الهاش ونكرانه طبعا ب `zip2john`
```shell-session
0xTroj6n@htb[/htb]$ zip2john ZIP.zip > zip.hash
0xTroj6n@htb[/htb]$ cat zip.hash 

ZIP.zip/customers.csv:$pkzip2$1*2*2*0*2a*1e*490e7510*0*42*0*2a*490e*409b*ef1e7feb7c1cf701a6ada7132e6a5c6c84c032401536faf7493df0294b0d5afc3464f14ec081cc0e18cb*$/pkzip2$:customers.csv:ZIP.zip::ZIP.zip
```

```shell-session
0xTroj6n@htb[/htb]$ john --wordlist=rockyou.txt zip.hash

0xTroj6n@htb[/htb]$ john zip.hash --show

ZIP.zip/customers.csv:1234:customers.csv:ZIP.zip::ZIP.zip

1 password hash cracked, 0 left
```
---
## Cracking OpenSSL encrypted GZIP files
- طبعا GZIP زي TAR بتحتاج اداة خارجيه عشان تشفرها وهيا الopenssl ف عشان اعرف الملف ده متشفر ولا لأ بستخدم امر `file`
```shell-session
0xTroj6n@htb[/htb]$ file GZIP.gzip 

GZIP.gzip: openssl enc'd data with salted password
```

- لما بتستخدم اداة زي JTR مع ملفات openssl الاداه ساعات بتطلع نتايجfalse positives وده لأن تشفير الOpenSSL ملوش توقيع او checksum قوي يقدر البرنامد يتأكد منه 100% إن الباسورد ده صح ولا لأ ف هنعتمد علي طريقة الFor-Loop من خلال اداة openssl نفسها
- الفكره اننا هنخلي الجهاز يجرب كل كلمة فالwordlist ويحاول يفك الملف فعليا
```shell-session
0xTroj6n@htb[/htb]$ for i in $(cat rockyou.txt);do openssl enc -aes-256-cbc -d -in GZIP.gzip -k $i 2>/dev/null| tar xz;done

gzip: stdin: not in gzip format
tar: Child returned status 1
tar: Error is not recoverable: exiting now

gzip: stdin: not in gzip format
tar: Child returned status 1
tar: Error is not recoverable: exiting now
<SNIP>
```

Once the `for` loop has finished, we can check the current directory for a newly extracted file.

```shell-session
0xTroj6n@htb[/htb]$ ls

customers.csv  GZIP.gzip  rockyou.txt
```
---
## Cracking BitLocker-encrypted drives
- الBitLocker ده full-disk encryption يعني بيشفر القرص بالكامل وده بيحمي البيانات  وشركة ميكروسوفت اللي عملاه وعملاه للwindows
- بيستخدم AES Encryption Alogrithm فالتشفير بطول مفتاح 128 او 256 بت وده تشفير مستحيل يتكسر بالbrute-force
- فالشركات الكبيره بتستخدم virtual drives ساعات بيستخدموها عشان بيخزنو فيها personal info و documents و notes ويشفروها
- عشان تكراك bitlocker encrypted drive بتستخدم `bitlocker2john` خلي بالك لما بتشغل الأداة بتطلعلك 4 هاشات مختلفه اول هاشين أول هاشين (`$bitlocker$0$..`): دول بتوع الباسورد (اللي الموظف كتبه بنفسه) واخر هاشين بتوع الrecovery key
```shell-session
0xTroj6n@htb[/htb]$ bitlocker2john -i Backup.vhd > backup.hashes
0xTroj6n@htb[/htb]$ grep "bitlocker\$0" backup.hashes > backup.hash
0xTroj6n@htb[/htb]$ cat backup.hash

$bitlocker$0$16$02b329c0453b9273f2fc1b927443b5fe$1048576$12$00b0a67f961dd80103000000$60$d59f37e70696f7eab6b8f95ae93bd53f3f7067d5e33c0394b3d8e2d1fdb885cb86c1b978f6cc12ed26de0889cd2196b0510bbcd2a8c89187ba8ec54f
```
اول ما تطلع الهاش خلاص كده تقدر تكراكه بالhashcat او JTR

```shell-session
0xTroj6n@htb[/htb]$ hashcat -a 0 -m 22100 '$bitlocker$0$16$02b329c0453b9273f2fc1b927443b5fe$1048576$12$00b0a67f961dd80103000000$60$d59f37e70696f7eab6b8f95ae93bd53f3f7067d5e33c0394b3d8e2d1fdb885cb86c1b978f6cc12ed26de0889cd2196b0510bbcd2a8c89187ba8ec54f' /usr/share/wordlists/rockyou.txt

<SNIP>

$bitlocker$0$16$02b329c0453b9273f2fc1b927443b5fe$1048576$12$00b0a67f961dd80103000000$60$d59f37e70696f7eab6b8f95ae93bd53f3f7067d5e33c0394b3d8e2d1fdb885cb86c1b978f6cc12ed26de0889cd2196b0510bbcd2a8c89187ba8ec54f:1234qwer
                                                          
Session..........: hashcat
Status...........: Cracked
Hash.Mode........: 22100 (BitLocker)
Hash.Target......: $bitlocker$0$16$02b329c0453b9273f2fc1b927443b5fe$10...8ec54f
Time.Started.....: Sat Apr 19 17:49:25 2025 (1 min, 56 secs)
Time.Estimated...: Sat Apr 19 17:51:21 2025 (0 secs)
Kernel.Feature...: Pure Kernel
Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:       25 H/s (9.28ms) @ Accel:64 Loops:4096 Thr:1 Vec:8
Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)
Progress.........: 2880/14344385 (0.02%)
Rejected.........: 0/2880 (0.00%)
Restore.Point....: 2816/14344385 (0.02%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:1044480-1048576
Candidate.Engine.: Device Generator
Candidates.#1....: pirate -> soccer9
Hardware.Mon.#1..: Util:100%

Started: Sat Apr 19 17:49:05 2025
Stopped: Sat Apr 19 17:51:22 2025
```
---
#### Mounting BitLocker-encrypted drives in Windows
- اسهل طريقة عشان تعمل mounting للbitlocker encrypted virtual drive علي الويندوز انك تdouble-click علي الvhd file. وبما إنه مشفر فالويندوز هيطلعلك رسالة ايررور بعد ما يظهر لك الهارد في الجهاز دوس عليه مرتين كمان هتلاقي الويندوز طلعلك المربع عشان تدخل كلمة السر
![](Pasted%20image%2020260120033401.png)
#### Mounting BitLocker-encrypted drives in Linux (or macOS)
It is also possible to mount BitLocker-encrypted drives in Linux (or macOS). To do this, we can use a tool called [dislocker](https://github.com/Aorimn/dislocker). First, we need to install the package using `apt`:

```shell-session
0xTroj6n@htb[/htb]$ sudo apt-get install dislocker
```
Next, we create two folders which we will use to mount the VHD.

  Cracking Protected Archives

```shell-session
0xTroj6n@htb[/htb]$ sudo mkdir -p /media/bitlocker
0xTroj6n@htb[/htb]$ sudo mkdir -p /media/bitlockermount
```

```shell-session
0xTroj6n@htb[/htb]$ sudo losetup -f -P Backup.vhd
0xTroj6n@htb[/htb]$ sudo dislocker /dev/loop0p2 -u1234qwer -- /media/bitlocker
0xTroj6n@htb[/htb]$ sudo mount -o loop /media/bitlocker/dislocker-file /media/bitlockermount
```
`sudo losetup -f -P Backup.vhd`
هنا ملف الvhd. ده مجرد ملف علي الجهاز الأمر ده بيخلي اللينكس يتعامل معاه كأنه هارد ديسك حقيقي متوصل بusb
**`-f`**: معناها شوف لي أول فتحة فاضية عندك ووصل الملف ده فيها
**`-P`**: معناها اقرأ التقسيمات اللي جوه الهارد ده

`sudo dislocker /dev/loop0p2 -u1234qwer -- /media/bitlocker`
هنا انت بتستخدم اداة dislocker عشان تفك تشفير bitlocker علي لينكس
**`/dev/loop0p2`**: ده مكان الهارد اللي عرفناه في الخطوة الأولى
**`-u1234qwer`**: ده الباسورد اللي إنت كسرته وجبته ببرنامج John!
**`/media/bitlocker`**: ده فولدر وسيط، الأداة هتحط فيه "ملف وهمي" مفكوك التشفير

`sudo mount -o loop /media/bitlocker/dislocker-file /media/bitlockermount`
ده بقي الخطوه الأخيره احنا بنقول للينكس خد الملف اللي فكينا تشفيره ده واعرضلي الملفات اللي جواه في الdir اللي اسمه `media/bitlockermount`

If everything was done correctly, we can now browse the files:

  Cracking Protected Archives

```shell-session
0xTroj6n@htb[/htb]$ cd /media/bitlockermount/
0xTroj6n@htb[/htb]$ ls -la
```

Once we have analyzed the files on the mounted drive, we can unmount it using the following commands:

  Cracking Protected Archives

```shell-session
0xTroj6n@htb[/htb]$ sudo umount /media/bitlockermount
0xTroj6n@htb[/htb]$ sudo umount /media/bitlocker
```